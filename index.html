<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthCare Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: #f0f2f5;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            position: relative;
        }

        .chat-container {
            width: 100%;
            max-width: 600px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-header {
            background: linear-gradient(135deg, #1976D2, #2196F3);
            color: white;
            padding: 1.25rem;
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            padding: 1rem;
            border-radius: 1rem;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.4;
            animation: messageAppear 0.3s ease;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-message {
            background: #f0f2f5;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }

        .user-message {
            background: #2196F3;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .option-btn {
            background: none;
            border: 1px solid #2196F3;
            color: #2196F3;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            text-align: left;
        }

        .option-btn:hover {
            background: #2196F3;
            color: white;
        }

        .text-input-form {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .text-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 0.75rem;
            font-size: 0.95rem;
        }

        .submit-btn {
            padding: 0.75rem 1.5rem;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .submit-btn:hover {
            background: #1976D3;
        }

        .product-card {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            width: 100%;
            height: 200px;
            border-radius: 0.75rem;
            object-fit: cover;
            margin-bottom: 1rem;
        }

        .cta-button {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: #2196F3;
            color: white;
            padding: 1rem 2rem;
            border-radius: 2rem;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            width: 100%;
        }

        .cta-button.visible {
            opacity: 1;
            visibility: visible;
        }

        .buy-now-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
            max-width: 200px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .buy-now-btn:hover {
            background: #3182ce;
        }

        @media (max-width: 600px) {
            body {
                padding: 0;
            }

            .chat-container {
                height: 100vh;
                border-radius: 0;
            }

            .cta-button {
                bottom: 1rem;
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }
        }

        /* Add these CSS styles */
        .recommendation {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 15px 0;
            max-width: 100%;
        }

        .recommendation-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eef1f5;
        }

        .recommendation-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin: 0;
            flex-grow: 1;
        }

        .recommendation-image {
            width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            object-fit: cover;
        }

        .recommendation-products {
            margin-top: 20px;
        }

        .recommendation-products-title {
            font-size: 16px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 12px;
        }

        .product-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .product-item {
            background: #f7fafc;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .product-item:hover {
            background: #edf2f7;
            transform: translateY(-2px);
        }

        .product-icon {
            width: 32px;
            height: 32px;
            background: #4299e1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .product-icon svg {
            width: 18px;
            height: 18px;
            color: white;
        }

        .product-name {
            font-size: 14px;
            color: #2d3748;
            font-weight: 500;
        }

        .recommendation-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eef1f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-price {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .buy-now-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .buy-now-btn:hover {
            background: #3182ce;
        }

        .learn-more-btn {
            background: transparent;
            color: #4299e1;
            border: 1px solid #4299e1;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .learn-more-btn:hover {
            background: #ebf8ff;
        }

        /* Add animation for recommendation appearance */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .recommendation {
            animation: slideIn 0.5s ease-out forwards;
        }

        /* Dark mode */
        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
            }

            .chat-container {
                background: #2d2d2d;
            }

            .bot-message {
                background: #3d3d3d;
                color: #fff;
            }

            .option-btn {
                border-color: #90caf9;
                color: #90caf9;
            }

            .option-btn:hover {
                background: #90caf9;
                color: #2d2d2d;
            }

            .text-input {
                background: #3d3d3d;
                border-color: #4d4d4d;
                color: white;
            }

            .product-card {
                background: #3d3d3d;
            }
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="chat-header">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                style="margin-right: 10px;">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </svg>
            Health Assistant
        </div>
        <div class="chat-messages" id="chat-messages"></div>
    </div>

    <a href="https://example.com/purchase" class="cta-button" id="cta-button">Buy Now</a>

    <script>
        // JSON Data Structure
        const chatbotData = {
            "initial_questions": [
                {
                    "text": "What are your hair concerns? (Select all that apply)",
                    "field": "concerns",
                    "type": "multiple_choice",
                    "options": ["Hairfall", "Dandruff", "Lice", "Split ends/Damaged or Dull Hair", "Premature Greying"]
                }
            ],
            "user_info_questions": [
                {
                    "text": "What's your Name?",
                    "field": "name",
                    "type": "text",
                    "validation": "^[a-zA-Z ]{2,30}$",
                    "errorMessage": "Please enter a valid name (2-30 characters, letters only)"
                },
                {
                    "text": "Please share your mobile number",
                    "field": "mobile",
                    "type": "tel",
                    "validation": "^[0-9]{10}$",
                    "errorMessage": "Please enter a valid 10-digit mobile number"
                },
                {
                    "text": "Please share your email address",
                    "field": "email",
                    "type": "email",
                    "validation": "^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,6}$",
                    "errorMessage": "Please enter a valid email address"
                },
                {
                    "text": "What's your gender?",
                    "field": "gender",
                    "type": "single_choice",
                    "options": ["Male", "Female", "Other"]
                },
                {
                    "text": "What's your age?",
                    "field": "age",
                    "type": "number",
                    "validation": "^[0-9]{1,3}$",
                    "errorMessage": "Please enter a valid age between 0-150"
                }
            ],
            "concern_flows": {
                "Hairfall": {
                    "questions": [
                        {
                            "question": "Please select your hairfall stage",
                            "options": ["Stage 1", "Stage 2", "Stage 3", "Stage 4-7"]
                        }
                    ],
                    "recommendations": {
                        "Stage 1": {
                            "name": "Early Hairfall Treatment Package",
                            "packageLink": "https://example.com/packages/early-hairfall",
                            "products": ["Black Tab Men/Women", "Neem Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Stage 2": {
                            "name": "Progressive Hairfall Treatment Package",
                            "packageLink": "https://example.com/packages/progressive-hairfall",
                            "products": ["Black Tab Men/Women", "Neem Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Stage 3": {
                            "name": "Advanced Hairfall Treatment Package",
                            "packageLink": "https://example.com/packages/advanced-hairfall",
                            "products": ["Black Tab Men/Women", "Antihairfall Shampoo", "Neem Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Stage 4-7": {
                            "name": "Intensive Hairfall Treatment Package",
                            "packageLink": "https://example.com/packages/intensive-hairfall",
                            "products": ["Black Tab Men/Women", "Anti hairfall Shampoo", "Infinity Hair Oil", "Neem Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        }
                    }
                },
                "Dandruff": {
                    "questions": [
                        {
                            "question": "What type of dandruff do you have?",
                            "options": ["Mild", "Heavy", "Seborrheic Dermatitis"]
                        }
                    ],
                    "recommendations": {
                        "Mild": {
                            "name": "Mild Dandruff Treatment Package",
                            "packageLink": "https://example.com/packages/mild-dandruff",
                            "products": ["Anti Dandruff Shampoo", "Neem Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Heavy": {
                            "name": "Heavy Dandruff Treatment Package",
                            "packageLink": "https://example.com/packages/heavy-dandruff",
                            "products": ["Anti Dandruff Shampoo", "Neem Comb", "Infinity Oil"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Seborrheic Dermatitis": {
                            "name": "Seborrheic Dermatitis Treatment Package",
                            "packageLink": "https://example.com/packages/dermatitis",
                            "products": ["Anti Dandruff Shampoo", "K2CT soap", "Neem Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        }
                    }
                },
                "Lice": {
                    "questions": [],
                    "recommendations": {
                        "default": {
                            "name": "Anti-Lice Treatment Package",
                            "packageLink": "https://example.com/packages/lice-treatment",
                            "products": ["Antilice", "Lice Comb", "Terminator Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        }
                    }
                },
                "Split ends/Damaged or Dull Hair": {
                    "questions": [
                        {
                            "question": "Please select your specific condition:",
                            "options": [
                                "Split Ends with Stage 3-7 & Mild Dandruff",
                                "Split Ends with Heavy Dandruff & Stage 3-7",
                                "Damaged/Dull Hair with Seborrhic Dermatitis"
                            ]
                        }
                    ],
                    "recommendations": {
                        "Split Ends with Stage 3-7 & Mild Dandruff": {
                            "name": "Split Ends Treatment Package - Mild",
                            "packageLink": "https://example.com/packages/split-ends-mild",
                            "products": ["Black tab Men/Women", "Anti Dandruff Shampoo", "Neem Comb", "Anti Hairfall Shampoo"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Split Ends with Heavy Dandruff & Stage 3-7": {
                            "name": "Split Ends Treatment Package - Heavy",
                            "packageLink": "https://example.com/packages/split-ends-heavy",
                            "products": ["Black tab Men/Women", "Anti Dandruff Shampoo", "Neem Comb", "Anti Hairfall Shampoo"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Damaged/Dull Hair with Seborrhic Dermatitis": {
                            "name": "Damaged Hair Treatment Package",
                            "packageLink": "https://example.com/packages/damaged-hair",
                            "products": ["Black tab Men/Women", "Anti Dandruff Shampoo", "K2CT Soap", "Infinity Oil"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        }
                    }
                },
                "Premature Greying": {
                    "questions": [
                        {
                            "question": "Do you have any additional concerns with premature greying?",
                            "options": [
                                "Hairfall & Premature Greying",
                                "Dandruff & Premature Greying",
                                "Damaged/Dull Hair & Premature Greying"
                            ]
                        },
                        {
                            "question": "What type of dandruff do you have with premature greying?",
                            "options": [
                                "Mild & Premature greying",
                                "Heavy & Premature Greying",
                                "Seborrhic Dermatitis & premature Greying"
                            ],
                            "condition": "Dandruff & Premature Greying"
                        }
                    ],
                    "recommendations": {
                        "Hairfall & Premature Greying": {
                            "name": "Anti-Greying Hairfall Treatment Package",
                            "packageLink": "https://example.com/packages/greying-hairfall",
                            "products": ["Black Tab Men/Women", "Infinity Hair Oil"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Mild & Premature greying": {
                            "name": "Anti-Greying Mild Dandruff Package",
                            "packageLink": "https://example.com/packages/greying-mild-dandruff",
                            "products": ["Anti Dandruff Shampoo", "Infinity Hairoil"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Heavy & Premature Greying": {
                            "name": "Anti-Greying Heavy Dandruff Package",
                            "packageLink": "https://example.com/packages/greying-heavy-dandruff",
                            "products": ["Anti Dandruff Shampoo", "Neem Comb", "Infinity Hair Oil"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Seborrhic Dermatitis & premature Greying": {
                            "name": "Anti-Greying Dermatitis Package",
                            "packageLink": "https://example.com/packages/greying-dermatitis",
                            "products": ["Anti Dandruff Shampoo", "K2CT Soap", "Neem Comb", "Infinity Hair Oil"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        },
                        "Damaged/Dull Hair & Premature Greying": {
                            "name": "Anti-Greying Damage Treatment Package",
                            "packageLink": "https://example.com/packages/greying-damage",
                            "products": ["Anti Hair fall Shampoo", "Infinity hair Oil", "Neem Comb"],
                            "image": "https://images.unsplash.com/photo-1564141696939-9eb6e957ccfc?q=80&w=3000&auto=format&fit=crop"
                        }
                    }
                }
            }
        };

        // Chatbot Class Implementation
        class ChatBot {
            constructor() {
                this.userData = {
                    concerns: []
                };
                this.currentStep = 0;
                this.conversationType = 'initial'; // initial -> concern -> user_info
                this.concernQueue = []; // Queue to process multiple concerns
                this.currentConcern = null; // Currently processing concern
                this.recommendationResults = []; // Store all recommendations
                this.init();
            }

            init() {
                this.showWelcome();
                setTimeout(() => this.askInitialQuestions(), 1000);
            }

            showWelcome() {
                this.addBotMessage("Welcome! Let's find the right hair care solutions for you.");
            }

            validateInput(value, type, validation) {
                if (!value.trim()) return false;

                if (validation) {
                    const regex = new RegExp(validation);
                    if (!regex.test(value)) return false;
                }

                switch (type) {
                    case 'email':
                        return /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(value);
                    case 'tel':
                        return /^[0-9]{10}$/.test(value);
                    case 'number':
                        const num = parseInt(value);
                        return !isNaN(num) && num >= 0 && num <= 150;
                    default:
                        return true;
                }
            }

            askInitialQuestions() {
                if (this.currentStep < chatbotData.initial_questions.length) {
                    const question = chatbotData.initial_questions[this.currentStep];
                    if (question.type === 'multiple_choice' && question.options) {
                        this.addBotMessage(question.text, false, null, question.options, null, true);
                    } else if (question.type === 'single_choice' && question.options) {
                        this.addBotMessage(question.text, false, null, question.options);
                    } else {
                        this.addBotMessage(question.text, true, question.type);
                    }
                }
            }

            handleTextInput(value) {
                let currentQuestion;

                if (this.conversationType === 'initial') {
                    currentQuestion = chatbotData.initial_questions[this.currentStep];
                } else if (this.conversationType === 'user_info') {
                    currentQuestion = chatbotData.user_info_questions[this.currentStep];
                }

                if (!this.validateInput(value, currentQuestion.type, currentQuestion.validation)) {
                    this.showError(currentQuestion.errorMessage || "Please provide a valid input");
                    return false;
                }

                this.userData[currentQuestion.field] = value;
                this.addUserMessage(value);
                this.currentStep++;

                if (this.conversationType === 'initial') {
                    if (this.currentStep < chatbotData.initial_questions.length) {
                        setTimeout(() => this.askInitialQuestions(), 500);
                    } else {
                        this.addBotMessage("Processing your selections...");
                        setTimeout(() => this.processNextConcern(), 1000);
                    }
                } else if (this.conversationType === 'user_info') {
                    if (this.currentStep < chatbotData.user_info_questions.length) {
                        setTimeout(() => this.askUserInfoQuestions(), 500);
                    } else {
                        setTimeout(() => this.showAllRecommendations(), 1000);
                    }
                }

                return true;
            }

            handleOptionSelect(option, isMultipleChoice = false, selectedOptions = []) {
                if (isMultipleChoice) {
                    // For multiple choice, we handle the selected array directly
                    this.addUserMessage("Selected concerns: " + selectedOptions.join(", "));
                    this.userData.concerns = selectedOptions;
                    this.concernQueue = [...selectedOptions]; // Copy the array to queue

                    this.currentStep++;
                    this.conversationType = 'concern';

                    // Process the first concern
                    setTimeout(() => this.processNextConcern(), 1000);
                    return;
                }

                // Single option selection handling
                this.addUserMessage(option);

                if (this.conversationType === 'initial') {
                    const currentQuestion = chatbotData.initial_questions[this.currentStep];
                    this.userData[currentQuestion.field] = option;
                    this.currentStep++;

                    if (this.currentStep < chatbotData.initial_questions.length) {
                        setTimeout(() => this.askInitialQuestions(), 500);
                    } else {
                        this.conversationType = 'concern';
                        setTimeout(() => this.processNextConcern(), 1000);
                    }
                } else if (this.conversationType === 'concern') {
                    this.userData.lastAnswer = option;
                    this.flowStep++;

                    if (this.currentFlow.questions && this.flowStep < this.currentFlow.questions.length) {
                        setTimeout(() => this.askConcernQuestion(), 500);
                    } else {
                        // Store this recommendation result and proceed to next concern
                        this.storeRecommendation(option);
                        setTimeout(() => this.processNextConcern(), 1000);
                    }
                } else if (this.conversationType === 'user_info') {
                    const currentQuestion = chatbotData.user_info_questions[this.currentStep];
                    this.userData[currentQuestion.field] = option;
                    this.currentStep++;

                    if (this.currentStep < chatbotData.user_info_questions.length) {
                        setTimeout(() => this.askUserInfoQuestions(), 500);
                    } else {
                        setTimeout(() => this.showAllRecommendations(), 1000);
                    }
                }
            }

            processNextConcern() {
                // If we have more concerns to process
                if (this.concernQueue.length > 0) {
                    this.currentConcern = this.concernQueue.shift();
                    this.startConcernFlow(this.currentConcern);
                } else {
                    // All concerns processed, move to user info
                    this.conversationType = 'user_info';
                    this.currentStep = 0;

                    // Add a transition message
                    this.addBotMessage(`Great! We've identified ${this.recommendationResults.length} solutions for your concerns. Before showing our recommendations, please provide some information about yourself.`);

                    setTimeout(() => this.askUserInfoQuestions(), 1000);
                }
            }

            startConcernFlow(concern) {
                const concernFlow = chatbotData.concern_flows[concern];

                if (!concernFlow) {
                    this.showError(`Sorry, we couldn't process your "${concern}" concern.`);
                    this.processNextConcern(); // Skip to next concern
                    return;
                }

                this.currentFlow = concernFlow;
                this.flowStep = 0;

                if (concernFlow.questions && concernFlow.questions.length > 0) {
                    this.addBotMessage(`Let's gather more information about your "${concern}" concern:`);
                    this.askConcernQuestion();
                } else {
                    // For concerns without questions (like Lice), store default as key
                    this.storeRecommendation('default');
                    this.processNextConcern();
                }
            }

            storeRecommendation(key) {
                const concern = this.currentConcern;
                const recommendations = this.currentFlow.recommendations;
                let recommendation;

                if (recommendations[key]) {
                    recommendation = recommendations[key];
                } else if (recommendations.default) {
                    recommendation = recommendations.default;
                } else {
                    recommendation = Object.values(recommendations)[0];
                }

                if (recommendation) {
                    this.recommendationResults.push({
                        concern: concern,
                        key: key,
                        recommendation: recommendation
                    });
                }
            }

            askConcernQuestion() {
                const question = this.currentFlow.questions[this.flowStep];
                if (!question) {
                    this.storeRecommendation(this.userData.lastAnswer || 'default');
                    this.processNextConcern();
                    return;
                }

                if (question.condition && this.userData.lastAnswer !== question.condition) {
                    this.flowStep++;
                    if (this.flowStep < this.currentFlow.questions.length) {
                        this.askConcernQuestion();
                    } else {
                        this.storeRecommendation(this.userData.lastAnswer);
                        this.processNextConcern();
                    }
                    return;
                }
                this.addBotMessage(question.question, false, null, question.options);
            }

            askUserInfoQuestions() {
                if (this.currentStep < chatbotData.user_info_questions.length) {
                    const question = chatbotData.user_info_questions[this.currentStep];
                    if (question.type === 'single_choice' && question.options) {
                        this.addBotMessage(question.text, false, null, question.options);
                    } else {
                        this.addBotMessage(question.text, true, question.type);
                    }
                }
            }

            showAllRecommendations() {
                if (this.recommendationResults.length === 0) {
                    this.addBotMessage("Sorry, we couldn't find any recommendations for your concerns.");
                    return;
                }

                // Thank the user first
                this.addBotMessage(`Thank you, ${this.userData.name}! Here are your personalized recommendations:`);

                // Display each recommendation
                this.recommendationResults.forEach((result, index) => {
                    setTimeout(() => {
                        this.addBotMessage(`Recommendation for "${result.concern}":`);
                        this.showSingleRecommendation(result.recommendation);
                    }, index * 1000); // Stagger the display of recommendations
                });

                // Add a follow-up message after all recommendations
                setTimeout(() => {
                    this.addBotMessage("Thank you for using our hair consultation service. If you have any questions about your recommendations, feel free to contact our support team!");
                }, (this.recommendationResults.length + 1) * 1000);
            }

            showSingleRecommendation(recommendation) {
                const html = `
            <div class="recommendation">
                <div class="recommendation-header">
                    <h3 class="recommendation-title">${recommendation.name}</h3>
                </div>
                
                <img src="${recommendation.image}" 
                     alt="${recommendation.name}" 
                     class="recommendation-image">
                
                <div class="recommendation-products">
                    <h4 class="recommendation-products-title">Package Includes:</h4>
                    <ul class="product-list">
                        ${recommendation.products.map(product => `
                            <li class="product-item">
                                <div class="product-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 12v10H4V12M22 7H2v5h20V7zM12 7V3h0v4M8 3h8"/>
                                    </svg>
                                </div>
                                <span class="product-name">${product}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                
                <div class="recommendation-footer">
                    <div class="package-info">
                        Complete Hair Care Solution Package
                    </div>
                    <a href="${recommendation.packageLink}" class="buy-now-btn">
                        Buy Package Now
                    </a>
                </div>
            </div>
        `;

                this.addBotMessage(null, false, null, null, html);
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = message;
                const messages = document.querySelector('#chat-messages');
                const lastMessage = messages.querySelector('.bot-message:last-child') || messages;
                lastMessage.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 3000);
            }

            addBotMessage(text, showInput = false, inputType = null, options = null, html = null, isMultipleChoice = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot-message';

                if (text) messageDiv.textContent = text;
                if (html) messageDiv.innerHTML = html;

                if (showInput) {
                    const form = document.createElement('div');
                    form.className = 'text-input-form';

                    const input = document.createElement('input');
                    input.type = inputType || 'text';
                    input.className = 'text-input';

                    // Add specific attributes based on input type
                    switch (inputType) {
                        case 'tel':
                            input.pattern = "[0-9]{10}";
                            input.maxLength = 10;
                            input.placeholder = "Enter 10-digit mobile number";
                            input.inputMode = "numeric";
                            break;
                        case 'email':
                            input.placeholder = "Enter your email address";
                            break;
                        case 'number':
                            input.min = "0";
                            input.max = "150";
                            input.placeholder = "Enter your age";
                            input.inputMode = "numeric";
                            break;
                        default:
                            input.placeholder = `Type your answer...`;
                    }

                    // Add input restrictions for number and tel types
                    if (inputType === 'tel' || inputType === 'number') {
                        input.onkeypress = (e) => {
                            if (!/[0-9]/.test(e.key) && e.key !== 'Enter' && e.key !== 'Backspace' && e.key !== 'Delete' && !e.ctrlKey) {
                                e.preventDefault();
                            }
                        };
                    }

                    const button = document.createElement('button');
                    button.className = 'submit-btn';
                    button.textContent = 'Submit';
                    button.onclick = () => {
                        if (this.handleTextInput(input.value)) {
                            form.remove();
                        }
                    };

                    input.onkeypress = (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            if (this.handleTextInput(input.value)) {
                                form.remove();
                            }
                        }
                    };

                    form.appendChild(input);
                    form.appendChild(button);
                    messageDiv.appendChild(form);

                    // Focus the input after it's added to the DOM
                    setTimeout(() => input.focus(), 100);
                }

                if (options) {
                    if (isMultipleChoice) {
                        // Create a multi-select UI
                        const optionsContainer = document.createElement('div');
                        optionsContainer.className = 'multi-options-container';

                        const selectedOptions = [];

                        options.forEach(option => {
                            const optionContainer = document.createElement('div');
                            optionContainer.className = 'multi-option-item';

                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.id = `option-${option.replace(/\s+/g, '-').toLowerCase()}`;
                            checkbox.value = option;
                            checkbox.className = 'multi-option-checkbox';

                            checkbox.onchange = () => {
                                if (checkbox.checked) {
                                    selectedOptions.push(option);
                                } else {
                                    const index = selectedOptions.indexOf(option);
                                    if (index > -1) {
                                        selectedOptions.splice(index, 1);
                                    }
                                }

                                // Enable/disable submit button based on selection
                                submitButton.disabled = selectedOptions.length === 0;
                            };

                            const label = document.createElement('label');
                            label.htmlFor = checkbox.id;
                            label.textContent = option;
                            label.className = 'multi-option-label';

                            optionContainer.appendChild(checkbox);
                            optionContainer.appendChild(label);
                            optionsContainer.appendChild(optionContainer);
                        });

                        // Add a submit button for multiple selections
                        const submitButton = document.createElement('button');
                        submitButton.className = 'multi-option-submit-btn';
                        submitButton.textContent = 'Continue with Selected Concerns';
                        submitButton.disabled = true; // Initially disabled until at least one option is selected

                        submitButton.onclick = () => {
                            if (selectedOptions.length > 0) {
                                this.handleOptionSelect(null, true, selectedOptions);
                                optionsContainer.remove();
                            }
                        };

                        optionsContainer.appendChild(submitButton);
                        messageDiv.appendChild(optionsContainer);
                    } else {
                        // Regular single-choice options
                        const optionsContainer = document.createElement('div');
                        optionsContainer.className = 'options-container';

                        options.forEach(option => {
                            const button = document.createElement('button');
                            button.className = 'option-btn';
                            button.textContent = option;
                            button.onclick = () => {
                                this.handleOptionSelect(option);
                                optionsContainer.remove();
                            };
                            optionsContainer.appendChild(button);
                        });

                        messageDiv.appendChild(optionsContainer);
                    }
                }

                document.getElementById('chat-messages').appendChild(messageDiv);
                this.scrollToBottom();
            }

            addUserMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message user-message';
                messageDiv.textContent = text;
                document.getElementById('chat-messages').appendChild(messageDiv);
                this.scrollToBottom();
            }

            scrollToBottom() {
                const container = document.getElementById('chat-messages');
                container.scrollTop = container.scrollHeight;
            }
        }

        // Initialize ChatBot when the document is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Add CSS for multi-select options
            const styleSheet = document.createElement("style");
            styleSheet.textContent = `
    .multi-options-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
        width: 100%;
    }
    
    .multi-option-item {
        display: flex;
        color: black;
        align-items: center;
        padding: 8px 12px;
        background-color: #f8f9fa;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .multi-option-item:hover {
        background-color: #e9ecef;
    }
    
    .multi-option-checkbox {
        margin-right: 10px;
    }
    
    .multi-option-label {
        flex: 1;
        cursor: pointer;
    }
    
    .multi-option-submit-btn {
        margin-top: 15px;
        padding: 10px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        align-self: center;
        width: 100%;
    }
    
    .multi-option-submit-btn:hover {
        background-color: #3e8e41;
    }
    
    .multi-option-submit-btn:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
    }
    
    .recommendation {
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
    }
    `;
            document.head.appendChild(styleSheet);

            const chatBot = new ChatBot();
        });
    </script>
</body>

</html>